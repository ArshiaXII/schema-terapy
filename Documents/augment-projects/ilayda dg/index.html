<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Doğum Günün Kutlu Olsun - Premium Love Story</title>

    <!-- Google Fonts - Professional -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- GSAP Core + ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- Locomotive Scroll for smooth scrolling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.css">
    <script src="https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#FF6B9D">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <!-- Continuous Sakura Rain -->
    <div id="sakura-rain" class="sakura-rain-container">
        <!-- Sakura petals will be generated by JavaScript -->
    </div>

    <!-- Smooth Scroll Container -->
    <div id="scroll-container" data-scroll-container>

        <!-- Navigation -->
        <nav class="nav-bar" data-scroll data-scroll-sticky data-scroll-target="#scroll-container">
            <div class="nav-content">
                <div class="nav-logo">🌸</div>
                <div class="nav-progress">
                    <div class="progress-line" id="progress-line"></div>
                </div>
                <div class="nav-menu">
                    <span class="nav-counter"><span id="current-section">01</span> / 04</span>
                </div>
            </div>
        </nav>

        <!-- Section 1: Hero -->
        <section class="section hero-section" data-scroll-section>
            <div class="hero-bg" data-scroll data-scroll-speed="-3">
                <img src="assets/ANA-FOTOGRAF.JPG" alt="Ana Fotoğraf" class="hero-image">
                <div class="hero-overlay"></div>
            </div>

            <div class="hero-content" data-scroll data-scroll-speed="2">
                <div class="hero-text">
                    <h1 class="hero-title">
                        <span class="title-line" data-scroll data-scroll-speed="1">Doğum Günün</span>
                        <span class="title-line" data-scroll data-scroll-speed="2">Kutlu Olsun</span>
                    </h1>
                    <p class="hero-subtitle" data-scroll data-scroll-speed="1" data-scroll-delay="0.2">
                        İlayda 🌸
                    </p>
                    <div class="hero-message" data-scroll data-scroll-speed="1" data-scroll-delay="0.4">
                        <p>Uzaklarda olsan da kalbimdesin... Bu özel günde sana olan sevgimi göstermek istedim 🌸</p>
                    </div>
                </div>
            </div>

            <div class="scroll-indicator" data-scroll data-scroll-speed="-2">
                <div class="scroll-text">Kaydır</div>
                <div class="scroll-arrow">↓</div>
            </div>
        </section>

        <!-- Section 2: Our Beginning -->
        <section class="section story-section" data-scroll-section>
            <div class="section-content">
                <div class="story-header" data-scroll data-scroll-speed="2">
                    <h2 class="section-title">Bizim Başlangıcımız</h2>
                    <p class="section-subtitle">Neredeyse 2 ay önce başlayan güzel yolculuk 🌸</p>
                </div>

                <div class="story-grid">
                    <div class="story-item" data-scroll data-scroll-speed="1">
                        <div class="story-image">
                            <img src="assets/FOTOGRAF-1.JPG" alt="Başlangıcımız">
                            <div class="story-overlay">
                                <h3>İlk Tanışmamız</h3>
                                <p>Her şeyin başladığı an...</p>
                            </div>
                        </div>
                    </div>

                    <div class="story-text" data-scroll data-scroll-speed="2">
                        <div class="text-content">
                            <h3>2 Ay Önce</h3>
                            <p>Seni tanıdığım günden beri hayatım bambaşka. Uzaklarda olsan da, her gün seni düşünmek beni mutlu ediyor. Bu kısa sürede bile ne kadar özel biri olduğunu anladım.</p>
                            <div class="story-date">💕 Güzel başlangıcımız</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Japan & You -->
        <section class="section japan-section" data-scroll-section>
            <div class="japan-bg" data-scroll data-scroll-speed="-2">
                <div class="sakura-petals">
                    <span class="petal">🌸</span>
                    <span class="petal">🌸</span>
                    <span class="petal">🌸</span>
                    <span class="petal">🌸</span>
                    <span class="petal">🌸</span>
                </div>
            </div>

            <div class="section-content">
                <div class="japan-header" data-scroll data-scroll-speed="1">
                    <h2 class="section-title">Sen ve Japonya</h2>
                    <p class="section-subtitle">Senin tutkun, benim ilhamım 🌸</p>
                </div>

                <div class="japan-content" data-scroll data-scroll-speed="2">
                    <div class="japan-message">
                        <div class="message-card">
                            <h3>🌸 Japonya Sevgin</h3>
                            <p>Japonya'ya olan tutkunu görünce seni daha çok seviyorum. Anime'leri ve ruhun gibi güzel olan japonya doğasını sevmen... Senin bu güzel kültüre olan sevgin beni de etkiliyor.</p>
                            <div class="japanese-elements">🍜 🍣 🎌 ⛩️ 🏮</div>
                        </div>

                        <div class="message-card">
                            <h3>🗾 Hayalimiz</h3>
                            <p>Bir gün birlikte Japonya'ya gideceğiz. Kyoto'da sakura çiçeklerini izleyeceğiz, Tokyo'da anime mağazalarını gezeceğiz, Osaka'da takoyaki yiyeceğiz. Shibuya Crossing'de el ele yürüyeceğiz!</p>
                            <div class="japanese-elements">🌸 🗼 🎋 🦊 ⛩️</div>
                        </div>

                        <div class="message-card special">
                            <h3>💕 Sana Sözüm</h3>
                            <p>Bu mesafeler geçici. Yakında yanında olacağım ve birlikte hayallerini gerçekleştireceğiz. Japonya'da da, her yerde! Seninle bu hayaller bana hayal değil hedef gibi geliyor.</p>
                            <div class="japanese-elements">👘 🎭 🎪 🎨 💫</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Birthday & Final -->
        <section class="section final-section" data-scroll-section>
            <div class="final-bg" data-scroll data-scroll-speed="-1">
                <img src="assets/FINAL-FOTOGRAF.JPG" alt="Final Fotoğraf" class="final-image">
                <div class="final-overlay"></div>
                <div class="birthday-decorations">
                    <span class="decoration">🎂</span>
                    <span class="decoration">🎉</span>
                    <span class="decoration">🌸</span>
                    <span class="decoration">💕</span>
                </div>
            </div>

            <div class="section-content">
                <div class="final-content" data-scroll data-scroll-speed="2">
                    <h2 class="section-title final-title">İyi Ki Doğdun!</h2>

                    <div class="final-message">
                        <div class="birthday-wish" data-scroll data-scroll-speed="1">
                            <p>Canım sevgilim, bu özel günde uzakta olsam da kalbim seninle...</p>
                            <p>Neredeysee 2 ay önce tanıştığımızdan beri hayatım çok daha güzel. Sen benim için çok özelsin! 🌸</p>
                        </div>

                        <div class="japan-promise" data-scroll data-scroll-speed="1.2">
                            <h3>🗾 Sana Sözüm</h3>
                            <p>Bir gün birlikte Japonya'ya gideceğiz ve hayallerini gerçekleştireceğiz!</p>
                        </div>

                        <!-- Birthday Cake Section -->
                        <div class="birthday-cake-container" data-scroll data-scroll-speed="1.3">
                            <div class="cake-wrapper">
                                <div class="birthday-cake" id="birthday-cake">
                                    <div class="cake-base">
                                        <div class="cake-decoration base-decoration">🌸 🎀 🌸</div>
                                    </div>
                                    <div class="cake-middle">
                                        <div class="cake-decoration middle-decoration">💕 ✨ 💕</div>
                                    </div>
                                    <div class="cake-top">
                                        <div class="cake-decoration top-decoration">🌸 23 🌸</div>
                                        <!-- 23 mumlar direkt pasta üstünde -->
                                        <div class="candles-on-cake">
                                            🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️🕯️
                                        </div>
                                    </div>
                                    <div class="cake-message">23 Yaşın Kutlu Olsun! 🎂</div>
                                </div>

                                <div class="blow-instruction" id="blow-instruction">
                                    <p>🎂 Mumları söndürmek için mikrofona üfle!</p>
                                    <div class="blow-options">
                                        <button class="blow-btn primary" onclick="startMicrophoneBlowing()">
                                            <span class="btn-icon">🎤</span>
                                            <span class="btn-text">Mikrofona Üfle</span>
                                        </button>
                                        <button class="blow-btn secondary" onclick="startBlowing()">
                                            <span class="btn-icon">💨</span>
                                            <span class="btn-text">Otomatik Söndür</span>
                                        </button>
                                    </div>
                                    <div class="microphone-status" id="microphone-status" style="display: none;">
                                        <p>🎤 Mikrofon dinleniyor... Üfle!</p>
                                        <div class="volume-indicator">
                                            <div class="volume-bar" id="volume-bar"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="celebration-message" id="celebration-message" style="display: none;">
                                    <h3>🎉 Tebrikler! 🎉</h3>
                                    <p>Tüm mumları söndürdün! Dileklerin gerçek olsun! ✨</p>
                                </div>
                            </div>
                        </div>

                        <div class="final-actions" data-scroll data-scroll-speed="1.5">
                            <button class="action-btn" onclick="openSpotifyLink()">
                                <span class="btn-icon">🎵</span>
                                <span class="btn-text">Bizim Şarkımız (Spotify)</span>
                            </button>

                            <button class="action-btn" onclick="createHeartExplosion()">
                                <span class="btn-icon">🌸</span>
                                <span class="btn-text">Sakura Yağmuru</span>
                            </button>
                        </div>

                        <div class="final-signature" data-scroll data-scroll-speed="2">
                            <p class="signature-text">İyi ki doğdun güzelim!</p>
                            <p class="signature-name">Seni çok seven, Arshia 💖</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Audio -->
    <audio id="birthday-song" preload="auto">
        <source src="assets/bizim-sarkimiz.mp3" type="audio/mpeg">
    </audio>

    <!-- Scripts -->
    <script>
        // GSAP Registration
        gsap.registerPlugin(ScrollTrigger);

        // Locomotive Scroll Setup
        let locoScroll;

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Locomotive Scroll
            locoScroll = new LocomotiveScroll({
                el: document.querySelector('#scroll-container'),
                smooth: true,
                multiplier: 1,
                class: 'is-revealed'
            });

            // Update ScrollTrigger when Locomotive Scroll updates
            locoScroll.on('scroll', ScrollTrigger.update);

            // Setup ScrollTrigger to work with Locomotive Scroll
            ScrollTrigger.scrollerProxy('#scroll-container', {
                scrollTop(value) {
                    return arguments.length ? locoScroll.scrollTo(value, 0, 0) : locoScroll.scroll.instance.scroll.y;
                },
                getBoundingClientRect() {
                    return {top: 0, left: 0, width: window.innerWidth, height: window.innerHeight};
                },
                pinType: document.querySelector('#scroll-container').style.transform ? 'transform' : 'fixed'
            });

            // Initialize animations
            initAnimations();
            initProgressBar();
            initBirthdayCake();
            initContinuousSakura();

            // Refresh ScrollTrigger
            ScrollTrigger.addEventListener('refresh', () => locoScroll.update());
            ScrollTrigger.refresh();
        });

        // Progress Bar Animation
        function initProgressBar() {
            const progressLine = document.getElementById('progress-line');
            const currentSection = document.getElementById('current-section');

            ScrollTrigger.create({
                trigger: '#scroll-container',
                start: 'top top',
                end: 'bottom bottom',
                scroller: '#scroll-container',
                onUpdate: self => {
                    const progress = self.progress;
                    progressLine.style.width = (progress * 100) + '%';

                    // Update section counter
                    const sectionNumber = Math.min(Math.floor(progress * 4) + 1, 4);
                    currentSection.textContent = sectionNumber.toString().padStart(2, '0');
                }
            });
        }

        // Initialize all animations
        function initAnimations() {
            // Hero animations
            gsap.from('.hero-title .title-line', {
                y: 100,
                opacity: 0,
                duration: 1.5,
                stagger: 0.2,
                ease: 'power3.out',
                delay: 0.5
            });

            // Section title animations
            gsap.utils.toArray('.section-title').forEach(title => {
                gsap.from(title, {
                    y: 50,
                    opacity: 0,
                    duration: 1,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: title,
                        start: 'top 80%',
                        scroller: '#scroll-container'
                    }
                });
            });

            // Photo gallery animations
            gsap.utils.toArray('.photo-item').forEach((item, index) => {
                gsap.from(item, {
                    y: 60,
                    opacity: 0,
                    duration: 1,
                    delay: index * 0.1,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: item,
                        start: 'top 85%',
                        scroller: '#scroll-container'
                    }
                });
            });

            // Floating hearts animation
            gsap.utils.toArray('.heart').forEach(heart => {
                gsap.to(heart, {
                    y: -20,
                    duration: 2,
                    repeat: -1,
                    yoyo: true,
                    ease: 'power1.inOut',
                    delay: Math.random() * 2
                });
            });

            // Birthday decorations animation
            gsap.utils.toArray('.decoration').forEach(decoration => {
                gsap.to(decoration, {
                    rotation: 360,
                    duration: 4,
                    repeat: -1,
                    ease: 'none',
                    delay: Math.random() * 2
                });
            });
        }

        // Continuous Sakura Rain
        function initContinuousSakura() {
            const sakuraContainer = document.getElementById('sakura-rain');
            const sakuraTypes = ['🌸', '🌺', '🌼'];

            function createSakuraPetal() {
                const petal = document.createElement('div');
                petal.className = 'sakura-petal';
                petal.innerHTML = sakuraTypes[Math.floor(Math.random() * sakuraTypes.length)];
                petal.style.left = Math.random() * 100 + '%';
                petal.style.fontSize = (Math.random() * 8 + 12) + 'px';
                petal.style.animationDelay = Math.random() * 2 + 's';
                petal.style.animationDuration = (Math.random() * 8 + 8) + 's';

                sakuraContainer.appendChild(petal);

                // Remove petal after animation
                setTimeout(() => {
                    if (petal.parentNode) {
                        petal.parentNode.removeChild(petal);
                    }
                }, 16000);
            }

            // Create initial petals
            for (let i = 0; i < 15; i++) {
                setTimeout(() => createSakuraPetal(), i * 500);
            }

            // Continue creating petals
            setInterval(createSakuraPetal, 800);
        }

        // Spotify link function with smooth transition
        function openSpotifyLink() {
            const button = event.target.closest('.action-btn');

            // Button animation
            gsap.to(button, {
                scale: 0.95,
                duration: 0.1,
                yoyo: true,
                repeat: 1,
                onComplete: () => {
                    // Change button text and icon
                    button.innerHTML = `
                        <span class="btn-icon">✅</span>
                        <span class="btn-text">Spotify'da Açılıyor...</span>
                    `;

                    // Wait a moment then open Spotify
                    setTimeout(() => {
                        const spotifyUrl = 'https://open.spotify.com/track/2aPTvyE09vUCRwVvj0I8WK?si=ac1b7e57269a4816';
                        window.open(spotifyUrl, '_blank');

                        // Reset button after opening
                        setTimeout(() => {
                            button.innerHTML = `
                                <span class="btn-icon">🎵</span>
                                <span class="btn-text">Bizim Şarkımız (Spotify)</span>
                            `;
                        }, 2000);
                    }, 800);
                }
            });

            // Show confetti
            createConfetti();
        }

        // Birthday song function
        function playBirthdaySong() {
            // For now, open Spotify link
            openSpotifyLink();
        }

        // Sakura rain function (Heart explosion with sakura)
        function createHeartExplosion() {
            const container = document.body;
            const sakuraItems = ['🌸', '💕', '🌸', '💖', '🌸'];

            for (let i = 0; i < 25; i++) {
                const sakura = document.createElement('div');
                sakura.innerHTML = sakuraItems[Math.floor(Math.random() * sakuraItems.length)];
                sakura.style.position = 'fixed';
                sakura.style.left = '50%';
                sakura.style.top = '50%';
                sakura.style.fontSize = (Math.random() * 15 + 20) + 'px';
                sakura.style.pointerEvents = 'none';
                sakura.style.zIndex = '9999';
                container.appendChild(sakura);

                const angle = (i / 25) * Math.PI * 2;
                const distance = 80 + Math.random() * 150;
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;

                gsap.to(sakura, {
                    x: endX,
                    y: endY,
                    rotation: Math.random() * 360,
                    opacity: 0,
                    scale: 0.3,
                    duration: 2.5,
                    ease: 'power2.out',
                    onComplete: () => {
                        if (sakura.parentNode) {
                            sakura.parentNode.removeChild(sakura);
                        }
                    }
                });
            }
        }

        // Initialize Birthday Cake with 23 candles
        function initBirthdayCake() {
            const candlesOnCake = document.querySelector('.candles-on-cake');

            if (candlesOnCake) {
                // Ensure exactly 23 candles are visible
                candlesOnCake.innerHTML = '🕯️'.repeat(23);
                candlesOnCake.setAttribute('data-total-candles', '23');
                candlesOnCake.setAttribute('data-lit-candles', '23');

                console.log('23 candles initialized on cake top');
            }
        }

        // Microphone blowing detection
        let audioContext;
        let microphone;
        let analyser;
        let dataArray;
        let isListening = false;
        let candlesBlown = 0;

        async function startMicrophoneBlowing() {
            const instruction = document.getElementById('blow-instruction');
            const micStatus = document.getElementById('microphone-status');
            const volumeBar = document.getElementById('volume-bar');

            try {
                // Request microphone access
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // Setup audio context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                microphone = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;

                microphone.connect(analyser);

                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);

                // Show microphone status
                micStatus.style.display = 'block';
                isListening = true;
                candlesBlown = 0;

                // Start listening for blowing
                detectBlowing();

            } catch (error) {
                console.log('Microphone access denied, falling back to automatic mode');
                startBlowing();
            }
        }

        function detectBlowing() {
            if (!isListening) return;

            analyser.getByteFrequencyData(dataArray);

            // Calculate average volume
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = sum / dataArray.length;

            // Update volume indicator
            const volumeBar = document.getElementById('volume-bar');
            const volumePercent = Math.min((average / 50) * 100, 100);
            volumeBar.style.width = volumePercent + '%';

            // Detect blowing (high volume) - Fixed version
            if (average > 25 && candlesBlown < 23) {
                const candlesOnCake = document.querySelector('.candles-on-cake');

                // Calculate how many candles to blow based on volume
                const candlesToBlow = Math.min(Math.floor(average / 20), 2, 23 - candlesBlown);

                if (candlesToBlow > 0) {
                    candlesBlown += candlesToBlow;

                    // Update candles display with smooth animation
                    gsap.to(candlesOnCake, {
                        scale: 1.05,
                        duration: 0.1,
                        yoyo: true,
                        repeat: 1,
                        onComplete: () => {
                            const litCandles = '🕯️'.repeat(23 - candlesBlown);
                            const blownCandles = '🕯'.repeat(candlesBlown);
                            candlesOnCake.innerHTML = litCandles + blownCandles;

                            // Create effects
                            createMiniWindEffect();
                            createCakeSmokeEffect();
                        }
                    });
                }
            }

            // Check if all candles are blown
            if (candlesBlown >= 23) {
                stopMicrophoneListening();
                showCelebration();
                return;
            }

            // Continue listening
            requestAnimationFrame(detectBlowing);
        }

        function createMiniWindEffect() {
            const cake = document.getElementById('birthday-cake');

            // Create multiple mini wind elements
            const windElements = ['💨', '🌬️', '☁️'];

            for (let i = 0; i < 5; i++) {
                const wind = document.createElement('div');
                wind.innerHTML = windElements[Math.floor(Math.random() * windElements.length)];
                wind.style.position = 'absolute';
                wind.style.left = (5 + Math.random() * 10) + '%';
                wind.style.top = (40 + Math.random() * 20) + '%';
                wind.style.fontSize = (12 + Math.random() * 8) + 'px';
                wind.style.opacity = '0.6';
                wind.style.pointerEvents = 'none';
                wind.style.zIndex = '10';
                wind.style.filter = 'blur(0.3px)';
                cake.appendChild(wind);

                gsap.to(wind, {
                    x: 150 + Math.random() * 100,
                    y: Math.random() * 40 - 20,
                    rotation: Math.random() * 360,
                    scale: 0.5,
                    opacity: 0,
                    duration: 1.2 + Math.random() * 0.8,
                    delay: i * 0.1,
                    ease: 'power2.out',
                    onComplete: () => {
                        if (wind.parentNode) {
                            wind.parentNode.removeChild(wind);
                        }
                    }
                });
            }

            // Add some sakura petals
            for (let i = 0; i < 3; i++) {
                const sakura = document.createElement('div');
                sakura.innerHTML = '🌸';
                sakura.style.position = 'absolute';
                sakura.style.left = (8 + Math.random() * 8) + '%';
                sakura.style.top = (45 + Math.random() * 10) + '%';
                sakura.style.fontSize = (8 + Math.random() * 4) + 'px';
                sakura.style.opacity = '0.7';
                sakura.style.pointerEvents = 'none';
                sakura.style.zIndex = '10';
                cake.appendChild(sakura);

                gsap.to(sakura, {
                    x: 120 + Math.random() * 80,
                    y: Math.random() * 30 - 15,
                    rotation: Math.random() * 720,
                    opacity: 0,
                    duration: 2 + Math.random(),
                    delay: 0.2 + i * 0.15,
                    ease: 'power1.out',
                    onComplete: () => {
                        if (sakura.parentNode) {
                            sakura.parentNode.removeChild(sakura);
                        }
                    }
                });
            }
        }

        function stopMicrophoneListening() {
            isListening = false;
            if (audioContext) {
                audioContext.close();
            }
            const micStatus = document.getElementById('microphone-status');
            micStatus.style.display = 'none';
        }

        function showCelebration() {
            const celebration = document.getElementById('celebration-message');
            celebration.style.display = 'block';
            gsap.from(celebration, {
                scale: 0,
                rotation: 360,
                duration: 1,
                ease: 'bounce.out'
            });
            createBirthdayConfetti();
            playBirthdaySong();
        }

        // Fixed candle blowing system
        function startBlowing() {
            const instruction = document.getElementById('blow-instruction');
            const celebration = document.getElementById('celebration-message');
            const candlesOnCake = document.querySelector('.candles-on-cake');

            // Hide instruction with animation
            gsap.to(instruction, {
                opacity: 0,
                y: -20,
                duration: 0.5,
                onComplete: () => instruction.style.display = 'none'
            });

            // Create dramatic wind effect
            createWindEffect();

            // Blow out candles in groups for better visual effect
            let currentCandles = 23;
            let blowStep = 0;

            const candleGroups = [5, 4, 6, 4, 4]; // Groups of candles to blow

            function blowNextGroup() {
                if (blowStep < candleGroups.length && currentCandles > 0) {
                    const candlesToBlow = Math.min(candleGroups[blowStep], currentCandles);
                    currentCandles -= candlesToBlow;

                    // Create visual effect before changing candles
                    gsap.to(candlesOnCake, {
                        scale: 1.1,
                        duration: 0.2,
                        yoyo: true,
                        repeat: 1,
                        onComplete: () => {
                            // Update candles display with smooth transition
                            const litCandles = '🕯️'.repeat(currentCandles);
                            const blownCandles = '🕯'.repeat(23 - currentCandles);
                            candlesOnCake.innerHTML = litCandles + blownCandles;

                            // Add smoke effect
                            createCakeSmokeEffect();

                            // Continue to next group
                            blowStep++;
                            if (currentCandles > 0) {
                                setTimeout(blowNextGroup, 600);
                            } else {
                                // All candles blown - celebration time!
                                setTimeout(showFinalCelebration, 800);
                            }
                        }
                    });
                }
            }

            // Start blowing sequence
            setTimeout(blowNextGroup, 500);
        }

        // Final celebration function
        function showFinalCelebration() {
            const celebration = document.getElementById('celebration-message');
            const candlesOnCake = document.querySelector('.candles-on-cake');

            // Make all candles gray/blown out
            candlesOnCake.innerHTML = '🕯'.repeat(23);
            candlesOnCake.style.filter = 'grayscale(100%) brightness(0.7)';

            // Show celebration
            celebration.style.display = 'block';
            gsap.from(celebration, {
                scale: 0,
                rotation: 360,
                duration: 1.2,
                ease: 'bounce.out'
            });

            // Create massive confetti
            createBirthdayConfetti();

            // Play birthday song
            setTimeout(() => {
                playBirthdaySong();
            }, 500);
        }

        // Create smoke effect for cake candles
        function createCakeSmokeEffect() {
            const cake = document.getElementById('birthday-cake');
            const smoke = document.createElement('div');
            smoke.innerHTML = '💨💨💨';
            smoke.style.position = 'absolute';
            smoke.style.top = '-20px';
            smoke.style.left = '50%';
            smoke.style.transform = 'translateX(-50%)';
            smoke.style.fontSize = '14px';
            smoke.style.opacity = '0.7';
            smoke.style.pointerEvents = 'none';
            smoke.style.zIndex = '20';
            cake.appendChild(smoke);

            gsap.to(smoke, {
                y: -30,
                opacity: 0,
                duration: 2,
                ease: 'power1.out',
                onComplete: () => {
                    if (smoke.parentNode) {
                        smoke.parentNode.removeChild(smoke);
                    }
                }
            });
        }

        // Individual emoji candle blow out with realistic animation
        function blowOutCandle(candle, index) {
            if (candle && candle.classList.contains('lit')) {
                // Candle flicker before going out
                gsap.to(candle, {
                    scale: 1.2,
                    rotation: 15,
                    duration: 0.1,
                    yoyo: true,
                    repeat: 2,
                    onComplete: () => {
                        // Change to blown out candle
                        candle.innerHTML = '🕯️';
                        candle.classList.remove('lit');
                        candle.classList.add('blown');

                        // Blow out animation
                        gsap.to(candle, {
                            scale: 0.8,
                            opacity: 0.6,
                            duration: 0.3,
                            ease: 'power2.out',
                            onComplete: () => {
                                // Add smoke effect
                                createEmojiSmoke(candle);
                            }
                        });
                    }
                });
            }
        }

        // Create emoji smoke effect
        function createEmojiSmoke(candle) {
            const smoke = document.createElement('div');
            smoke.innerHTML = '💨';
            smoke.style.position = 'absolute';
            smoke.style.fontSize = '12px';
            smoke.style.left = '50%';
            smoke.style.top = '-10px';
            smoke.style.transform = 'translateX(-50%)';
            smoke.style.pointerEvents = 'none';
            smoke.style.zIndex = '101';
            candle.style.position = 'relative';
            candle.appendChild(smoke);

            gsap.to(smoke, {
                y: -25,
                x: Math.random() * 20 - 10,
                rotation: Math.random() * 360,
                scale: 0.5,
                opacity: 0,
                duration: 2,
                ease: 'power1.out',
                onComplete: () => {
                    if (smoke.parentNode) {
                        smoke.parentNode.removeChild(smoke);
                    }
                }
            });
        }

        // Enhanced wind effect with multiple elements
        function createWindEffect() {
            const windContainer = document.createElement('div');
            windContainer.style.position = 'absolute';
            windContainer.style.top = '0';
            windContainer.style.left = '0';
            windContainer.style.width = '100%';
            windContainer.style.height = '100%';
            windContainer.style.pointerEvents = 'none';
            windContainer.style.zIndex = '10';
            document.body.appendChild(windContainer);

            // Different wind elements
            const windElements = ['💨', '🌬️', '☁️', '🌪️'];

            // Create wind particles with variety
            for (let i = 0; i < 25; i++) {
                const windParticle = document.createElement('div');
                windParticle.innerHTML = windElements[Math.floor(Math.random() * windElements.length)];
                windParticle.style.position = 'fixed';
                windParticle.style.left = (10 + Math.random() * 20) + '%';
                windParticle.style.top = (35 + Math.random() * 30) + '%';
                windParticle.style.fontSize = (Math.random() * 12 + 12) + 'px';
                windParticle.style.opacity = '0.5';
                windParticle.style.pointerEvents = 'none';
                windParticle.style.zIndex = '9999';
                windParticle.style.filter = 'blur(0.5px)';
                windContainer.appendChild(windParticle);

                // More realistic wind movement
                gsap.to(windParticle, {
                    x: window.innerWidth * (0.5 + Math.random() * 0.3),
                    y: Math.random() * 120 - 60,
                    rotation: Math.random() * 720,
                    scale: 0.3 + Math.random() * 0.4,
                    opacity: 0,
                    duration: 2 + Math.random() * 1.5,
                    delay: Math.random() * 0.8,
                    ease: 'power1.out'
                });
            }

            // Add some sakura petals blown by wind
            for (let i = 0; i < 10; i++) {
                const sakura = document.createElement('div');
                sakura.innerHTML = '🌸';
                sakura.style.position = 'fixed';
                sakura.style.left = (15 + Math.random() * 15) + '%';
                sakura.style.top = (40 + Math.random() * 20) + '%';
                sakura.style.fontSize = (Math.random() * 8 + 10) + 'px';
                sakura.style.opacity = '0.7';
                sakura.style.pointerEvents = 'none';
                sakura.style.zIndex = '9999';
                windContainer.appendChild(sakura);

                gsap.to(sakura, {
                    x: window.innerWidth * 0.7,
                    y: Math.random() * 80 - 40,
                    rotation: Math.random() * 1080,
                    opacity: 0,
                    duration: 3 + Math.random() * 2,
                    delay: Math.random() * 1,
                    ease: 'power1.inOut'
                });
            }

            // Remove wind container after animation
            setTimeout(() => {
                if (windContainer.parentNode) {
                    windContainer.parentNode.removeChild(windContainer);
                }
            }, 6000);
        }

        // Beautiful smoke effect with multiple elements
        function createAdvancedSmoke(candle) {
            const smokeContainer = document.createElement('div');
            smokeContainer.style.position = 'absolute';
            smokeContainer.style.top = '-15px';
            smokeContainer.style.left = '50%';
            smokeContainer.style.transform = 'translateX(-50%)';
            smokeContainer.style.pointerEvents = 'none';
            candle.appendChild(smokeContainer);

            // Different smoke elements for variety
            const smokeElements = ['💨', '☁️', '🌫️'];

            // Create multiple smoke particles with different effects
            for (let i = 0; i < 8; i++) {
                const smoke = document.createElement('div');
                smoke.innerHTML = smokeElements[Math.floor(Math.random() * smokeElements.length)];
                smoke.style.position = 'absolute';
                smoke.style.fontSize = (6 + Math.random() * 8) + 'px';
                smoke.style.opacity = '0.7';
                smoke.style.left = (Math.random() * 12 - 6) + 'px';
                smoke.style.filter = 'blur(0.5px)';
                smokeContainer.appendChild(smoke);

                // Realistic smoke animation
                gsap.to(smoke, {
                    y: -40 - Math.random() * 30,
                    x: Math.random() * 25 - 12.5,
                    rotation: Math.random() * 180,
                    scale: 0.2 + Math.random() * 0.3,
                    opacity: 0,
                    duration: 2.5 + Math.random() * 1.5,
                    delay: i * 0.08,
                    ease: 'power1.out'
                });
            }

            // Add sparkle effect when candle goes out
            for (let i = 0; i < 3; i++) {
                const sparkle = document.createElement('div');
                sparkle.innerHTML = '✨';
                sparkle.style.position = 'absolute';
                sparkle.style.fontSize = (4 + Math.random() * 4) + 'px';
                sparkle.style.left = (Math.random() * 8 - 4) + 'px';
                sparkle.style.top = (Math.random() * 8 - 4) + 'px';
                smokeContainer.appendChild(sparkle);

                gsap.to(sparkle, {
                    y: -15 - Math.random() * 10,
                    x: Math.random() * 15 - 7.5,
                    rotation: Math.random() * 360,
                    scale: 0,
                    opacity: 0,
                    duration: 1 + Math.random() * 0.5,
                    delay: 0.2 + i * 0.1,
                    ease: 'power2.out'
                });
            }

            // Remove smoke container after animation
            setTimeout(() => {
                if (smokeContainer.parentNode) {
                    smokeContainer.parentNode.removeChild(smokeContainer);
                }
            }, 5000);
        }

        // Birthday confetti function
        function createBirthdayConfetti() {
            const container = document.body;
            const confettiItems = ['🎉', '🎊', '🎈', '🎂', '✨', '💖', '🌸', '23'];

            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.innerHTML = confettiItems[Math.floor(Math.random() * confettiItems.length)];
                confetti.style.position = 'fixed';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-50px';
                confetti.style.fontSize = (Math.random() * 15 + 15) + 'px';
                confetti.style.pointerEvents = 'none';
                confetti.style.zIndex = '9999';
                container.appendChild(confetti);

                gsap.to(confetti, {
                    y: window.innerHeight + 100,
                    rotation: Math.random() * 360,
                    duration: 3 + Math.random() * 2,
                    ease: 'power1.in',
                    delay: Math.random() * 2,
                    onComplete: () => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }
                });
            }
        }

        // Confetti function
        function createConfetti() {
            createBirthdayConfetti();
        }
    </script>
</body>
</html>
